# 平台调度与本地复算成本差异分析

## 1. 对比对象与口径

- **平台导出 OJ**：`output/platform_verify/平台导出文件_最终_oj.csv`（已删 ICE）
- **本地 MILP OJ**：`runs/full_milp/full_milp_20260113_134017/2c5c/2c5c06fab09754cf_oj.csv`
- **评分口径**：`configs/oj_score.yaml`
- **价格/碳因子数据**：`data/raw`

说明：两份 OJ CSV 都用同一套价格与碳因子复算，确保比较口径一致。

## 2. 总量对比（平台 - 本地）

| 指标 | 本地复算 | 平台复算 | 差异 |
| --- | --- | --- | --- |
| C_total | 687,945,933.452 | 687,892,475.823 | **-53,457.629** |
| C_OP | 298,020,097.928 | 297,963,584.751 | **-56,513.177** |
| C_OP_ele | 170,654,604.380 | 170,531,669.812 | **-122,934.567** |
| C_OP_gas | 127,365,493.549 | 127,431,914.939 | **+66,421.390** |
| C_Carbon | 46,196,639.954 | 46,199,695.503 | **+3,055.549** |
| E_elec (MWh) | 80,915.552 | 80,870.539 | **-45.013** |
| E_gas (MWh) | 96,078.848 | 96,128.953 | **+50.105** |
| E_total (tCO2) | 176,994.400 | 176,999.493 | **+5.093** |
| Score | 88.897961 | 88.901478 | **+0.003517** |

结论：平台成本确实**略低于本地复算**，但差异仅 5.3e4（约 0.0078%），属于非常小的量级。

## 3. 日尺度差异特征（来源：`output/platform_verify/平台导出文件_最终_diff_report.md`）

- 购电日差异峰值约 **-10.8 MWh/日**。
- 购气日差异峰值约 **+24.0 MWh/日**。
- 切负荷全年为 0，差异为 0。

这类差异呈现明显“整块”特征：  
**24 MWh/日≈ 1 MW × 24 h**，  
**10.8 MWh/日≈ 0.45 MW × 24 h**。  
符合“离散功率块/设备阶梯化”或“求解器容差下的离散切换”现象。

## 4. 为什么平台成本可能比本地更低？

### 4.1 多解/退化与求解器差异
本地 MILP 与平台日内调度在同一约束下，理论上应当得到**等价最优**。  
但在存在整数变量与离散功率块时，往往出现**多最优解**。  
平台与本地求解器的启发式/分支策略不同，会落到**不同的等价解**，从而带来微小成本差异。

### 4.2 日内求解与全年一体求解的“细节差异”
本地模型是全年单体 MILP（但储能按日闭环），平台为逐日求解。  
当目标可分解、约束日内闭合时，二者理论上等价；  
但在实际求解中，**日内子问题的数值容差、整数可行性阈值**会放大为**整日块状差异**。

### 4.3 价格/碳因子与导出口径差异被放大
评分基于 OJ 口径，价格与碳因子为小时级数据。  
平台导出结果存在细微数值/舍入差异（例如小数位处理），  
在**电/气相对价格差较大**时，会触发电气替代切换，导致总成本微变。

## 5. 异常行为排除结论

- 平台结果中**没有负的失负荷**（已检验）。
- 负值只出现在**线路潮流**与**节点相角**，属于正常的方向/参考角表示。
- 差异量级与“求解策略差异 + 离散功率块切换”一致，暂未发现“成本被异常低估”的证据。

## 6. 建议的进一步验证

1. **复现实验**：在本地采用“逐日求解 + 平台同等容差”重跑，检查差异是否收敛。  
2. **词典序目标（Tie-break）**：在本地加入次目标（最小化真实 OJ 成本），减少多解漂移。  
3. **差异日深挖**：对 Day 350/360/362 做小时级电气替代与储能充放的对比，定位具体切换原因。

