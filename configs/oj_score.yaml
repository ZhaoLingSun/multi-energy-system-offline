# ScoreSpec - 评分规格配置文件（唯一真值来源）
# 
# 本文件是所有评分相关常数的唯一定义位置。
# 阶段0写入，阶段1/2/3只读消费。
# 禁止在代码中硬编码这些常数值。
#
# ============================================================
# ⚠️ 已冻结状态 - 2025-12-20 Stage0 探针验证完成
# ============================================================

score_spec:
  # === OJ 模式（阶段0探针已确定）===
  # uses_dispatch: OJ 使用提交的调度数据（CSV 中的运行结果列被消费计分）
  # recalculates_dispatch: OJ 用原始价格重算调度
  # 
  # 探针验证结论：
  #   - ans_load1 列：扰动 +0.01MW 导致分数变化 ✓
  #   - ans_ele 列：扰动 +100MW 导致分数变化 ✓
  #   - 因此 OJ 确实消费 CSV 中的调度数据
  oj_mode: "uses_dispatch"  # ✅ 已冻结 (2025-12-20 探针验证)

  # === 成本结构 ===
  cost_formula: "C_total = C_CAP + C_OP + C_Carbon"

  # === 失负荷惩罚（题面明确）===
  load_shedding_penalty: 500000  # 元/MWh

  # === 碳约束（题面明确）===
  carbon:
    threshold: 100000  # 吨/年（10万吨）
    price: 600         # 元/tCO2（超额部分）
    calc_basis: "purchased"  # 按购入侧计算（购电+购气）
    elec_factor_unit: "tCO2/MWh"
    gas_factor_unit: "tCO2/m3"
    gas_emission_factor: 0.002  # tCO2/m³（天然气排放因子）
    renewable_factor: 0  # 可再生能源碳因子为0
    chp_carbon_source: "gas_input"  # CHP按进气量计碳

  # === 投资年化（题面明确）===
  capex:
    discount_rate: 0.04  # i = 4%
    annuity_formula: "Cap × UnitCost × i(1+i)^n / ((1+i)^n - 1)"

  # === 单位折算（题面明确 + 探针验证）===
  units:
    gas_m3_to_MWh: 0.01  # 1 m³ = 0.01 MWh = 10 kWh
    time_step_h: 1       # Δt = 1 hour
    # ⚠️ 关键：logistic 输入的成本单位为"万元"
    # 即 cost_yuan 进入 logistic 前需除以 cost_unit
    cost_unit: 10000     # ✅ 已冻结 - 1 logistic 单位 = 10000 元 = 1 万元

  # === Score 映射（logistic）===
  # 公式: Score = 100 / (1 + exp((x - x0) / k))
  # 其中 x = C_total / cost_unit = C_total / 10000 (单位：万元)
  logistic:
    x0: 100000   # ✅ 已冻结 (探针反推验证一致)
    k: 15000     # ✅ 已冻结 (探针反推验证一致)
    formula: "Score = 100 / (1 + exp((C_total / cost_unit - x0) / k))"

  # === 舍入规则（待阶段0校准）===
  rounding:
    cost_decimals: 2      # 成本保留小数位
    score_decimals: 11    # OJ 分数显示精度高达 11 位小数
    policy: "round"       # round/floor/ceil

  # === 平台导出数据结构 ===
  export_structure:
    objects:
      load_shedding: 9    # 切负荷：3区×3类负荷 = 9个对象
      thermal_power: 3    # 火电：3个机组
      gas_source: 1       # 气源：1个
    rows:
      load_shedding: 3285  # 9×365
      thermal_power: 1095  # 3×365
      gas_source: 365      # 1×365
    plan18_count: 18       # 规划行数量
    plan18_col2_threshold: 200  # col2 > 200 为规划行

  # === 校准状态 ===
  calibration:
    status: "frozen"  # pending/calibrated/frozen
    last_updated: "2025-12-20T17:00:00+08:00"
    frozen_by: "Stage0 探针验证"
    
    # === 探针验证记录（单一真源）===
    probe_results:
      baseline:
        id: "S0"
        score: 5.24023235480
        timestamp: "2025-12-20T16:10:00+08:00"
        file: "HWdata_for_OJ.csv"
        description: "Baseline 提交"
      probe_load:
        id: "S1"
        score: 5.24006683620
        timestamp: "2025-12-20T16:32:00+08:00"
        file: "HWdata_for_OJ_probe_ans_load1_eps0p01_h1000.csv"
        perturbation: "ans_load1@h1000 += 0.01 MW"
        delta_score: -0.00016551860
      probe_ele:
        id: "S2"
        score: 5.23719406169
        timestamp: "2025-12-20T16:42:00+08:00"
        file: "HWdata_for_OJ_probe_ans_ele_plus100_h1000.csv"
        perturbation: "ans_ele@h1000 += 100 MW"
        delta_score: -0.00303829311
    
    # === 探针结论 ===
    conclusions:
      - "logistic(x0=100000, k=15000) 与探针计算完全一致"
      - "成本进入 logistic 前的单位为'万元'（cost_unit=10000）"
      - "OJ 消费 CSV 的运行结果列：ans_load1、ans_ele"
      - "oj_mode 确定为 uses_dispatch"
